<%- include('partials/header') %>

 <div class="product-page-container">
 <div class="breadcrumb">
 <a href="/">Ana Səhifə</a> <i class="ri-arrow-right-s-line"></i>
 <span>
 <%= product.category %>
 </span> <i class="ri-arrow-right-s-line"></i>
 <span>
 <%= product.name %>
 </span>
 </div>

 <div class="product-detail-grid">
 <div class="product-detail-left">
 <div class="product-gallery">
 <% if (product.image && !String(product.image).includes('placeholder')) { %>
 <img src="<%= product.image %>" alt="<%= product.name %>" id="mainProdImage">
 <% } else { %>
 <div class="no-image-placeholder">
 <i class="ri-gamepad-line"></i>
 <span>Resim yok</span>
 </div>
 <% } %>
 <% if (product.badge) { %>
 <div class="badge-float">
 <%= product.badge %>
 </div>
 <% } %>
 </div>
 </div>

 <div class="product-detail-right">
 <span class="p-cat-tag">
 <%= product.category %>
 </span>
 <h1 class="p-title">
 <%= product.name %>
 </h1>

 <div class="p-meta">
 <span><i class="ri-checkbox-circle-line"></i> Stokdadır</span>
 <span><i class="ri-flashlight-line"></i> Anında teslimat</span>
 </div>

 <div class="p-price-card">
 <div class="p-prices">
 <% if (product.oldPrice) { %>
 <span class="p-old">
 <%= product.oldPrice.toFixed(2) %> AZN
 </span>
 <% } %>
 <span class="p-current">
 <%= product.price.toFixed(2) %> AZN
 </span>
 </div>

 <% if (product.category.toUpperCase().includes('PUBG')) { %>
 <div class="mb-4">
 <label class="small font-weight-bold text-uppercase"
 style="letter-spacing: 0.5px; color: #64748b;">Player ID</label>
 <div class="d-flex" style="gap: 8px;">
 <input type="text" id="player_id" class="form-control" placeholder="5124018318"
 style="height: 48px; border-radius: 8px; font-weight: 600;">
 <button class="btn btn-dark" id="btnCheckID"
 style="height: 48px; border-radius: 8px; padding: 0 25px; font-weight: 600;">Yoxla</button>
 </div>
 <div id="idStatus" class="mt-2"
 style="min-height: 20px; font-size: 0.85rem; font-weight: 500;"></div>
 <input type="hidden" id="player_nickname" value="">
 </div>

 <script>
 document.getElementById('btnCheckID').addEventListener('click', async function () {
 const id = document.getElementById('player_id').value;
 const statusDiv = document.getElementById('idStatus');
 if (!id) {
 statusDiv.innerHTML = '<span class="text-danger">Player ID daxil edin.</span>';
 return;
 }

 const btn = this;
 const hiddenNickname = document.getElementById('player_nickname');
 const fallbackNote = 'ID: ' + id;

 btn.disabled = true;
 btn.innerHTML = '<i class="ri-loader-4-line icon-spin"></i>';
 statusDiv.innerHTML = '<span class="text-muted">Yoxlanılır...</span>';

 try {
 const res = await fetch('/api/pubg-check?player_id=' + id);
 const data = await res.json();

 if (data.success) {
 statusDiv.innerHTML = '<span class="text-success"><i class="ri-check-line"></i> ' + data.nickname + '</span>';
 hiddenNickname.value = data.nickname || fallbackNote;
 } else {
 statusDiv.innerHTML = '<span class="text-warning"><i class="ri-error-warning-line"></i> ID tapılmadı, ID ilə qəbul ediləcək.</span>';
 hiddenNickname.value = fallbackNote;
 }
 } catch (e) {
 statusDiv.innerHTML = '<span class="text-warning"><i class="ri-error-warning-line"></i> Bağlantı xətası, ID ilə qəbul ediləcək.</span>';
 hiddenNickname.value = fallbackNote;
 }

 btn.disabled = false;
 btn.innerHTML = 'Yoxla';
 });

 document.getElementById('player_id').addEventListener('input', function () {
 const id = this.value.trim();
 document.getElementById('player_nickname').value = id ? ('ID: ' + id) : '';
 });
 </script>
 <% } %>

 <div class="p-actions">
 <button class="btn btn-primary btn-large" id="btnAddToCart" onclick="handleAddToCart()"
 >
 <i class="ri-shopping-cart-2-line"></i> Səbətə əlavə et
 </button>
 <button class="btn btn-outline wishlist-btn"
 onclick="toggleWishlist('<%= product.id %>', this)" style="min-width: 50px;">
 <i class="ri-heart-line"></i>
 </button>
 </div>

 <script>
 function handleAddToCart() {
 const isPubg ="<%= product.category.toUpperCase().includes('PUBG') %>" ==="true";
 let extra = {};
 if (isPubg) {
 const pid = (document.getElementById('player_id').value || '').trim();
 let pnick = (document.getElementById('player_nickname').value || '').trim();
 if (!pid) {
 Toastify({ text:"Zəhmət olmasa Player ID daxil edin.", backgroundColor:"#ef4444" }).showToast();
 return;
 }
 if (!pnick) pnick = 'ID: ' + pid;
 extra = { player_id: pid, player_nickname: pnick };
 }
 const productObj = {
 id: '<%= product.id %>',
 name: <%- JSON.stringify(product.name ||"") %>,
 price: <%= Number(product.price) || 0 %>,
 img: <%- JSON.stringify(product.image_path || product.image ||"") %>,
 ...extra
 };
 addToCartFromPage(productObj);
 }
 </script>
 </div>

 <div class="p-features">
 <div class="f-item"><i class="ri-check-line"></i> 100% Orijinal Məhsul</div>
 <div class="f-item"><i class="ri-check-line"></i> 7/24 Dəstək</div>
 <div class="f-item"><i class="ri-check-line"></i> Anında Teslimat</div>
 <div class="f-item"><i class="ri-check-line"></i> Təhlükəsiz Ödəniş</div>
 </div>

 <div class="p-description-box">
 <h4>Məhsul Haqqında</h4>
 <p>
 <%= product.description %>
 </p>
 </div>
 </div>
 </div>

 <% if (similarProducts && similarProducts.length> 0) { %>
 <section class="section-container" style="margin-top: 80px;">
 <div class="section-header">
 <h3>Oxşar Məhsullar</h3>
 </div>
 <div class="product-grid">
 <% similarProducts.forEach(prod=> { %>
 <%- include('partials/product_card', { product: prod }) %>
 <% }) %>
 </div>
 </section>
 <% } %>
 </div>

 <%- include('partials/footer') %>
