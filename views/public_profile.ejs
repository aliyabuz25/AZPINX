<%- include('partials/header') %>

<div class="product-page-container">
  <% const totalPublicOrders = (publicOrders || []).length; %>
  <% const totalPublicSpend = (publicOrders || []).reduce(function(sum, o){ return sum + Number(o.amount || 0); }, 0); %>
  <% const completedPublicOrders = (publicOrders || []).filter(function(o){ return String(o.status || '').toLowerCase() === 'completed'; }).length; %>
  <div class="public-profile-card">
    <div class="public-avatar">
      <% if (profileUser.avatar_path) { %>
        <img src="<%= profileUser.avatar_path %>" alt="<%= profileUser.full_name %>">
      <% } else { %>
        <span><%= String(profileUser.full_name || 'U').charAt(0).toUpperCase() %></span>
      <% } %>
    </div>
    <div class="public-main">
      <h2><%= profileUser.full_name %></h2>
      <div class="public-rank" style="color:<%= (profileUser.rank_meta && profileUser.rank_meta.color) || '#64748b' %>">
        <i class="<%= (profileUser.rank_meta && profileUser.rank_meta.icon) || 'ri-user-star-line' %>"></i>
        <span><%= (profileUser.rank_meta && profileUser.rank_meta.label) || 'Üzv' %></span>
      </div>
      <p><%= profileUser.public_bio || 'Bu istifadəçi hələ bio əlavə etməyib.' %></p>
      <small class="text-muted">Qeydiyyat: <%= new Date(profileUser.created_at).toLocaleDateString() %></small>
      <div class="mt-3">
        <a href="/people" class="btn btn-outline btn-sm">İcmaya qayıt</a>
      </div>
    </div>
  </div>

  <div class="public-stats-grid mt-4">
    <div class="public-stat-item">
      <small>Sifariş sayı</small>
      <strong><%= totalPublicOrders %></strong>
    </div>
    <div class="public-stat-item">
      <small>Tamamlanan</small>
      <strong><%= completedPublicOrders %></strong>
    </div>
    <div class="public-stat-item">
      <small>Top alış</small>
      <strong><%= Number(totalPublicSpend).toFixed(2) %> AZN</strong>
    </div>
  </div>

  <div class="public-profile-card mt-4">
    <h4 class="mb-3">Son sifarişlər</h4>
    <% if (publicOrders && publicOrders.length) { %>
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>#</th>
              <th>Məhsul</th>
              <th>Məbləğ</th>
              <th>Status</th>
              <th>Tarix</th>
            </tr>
          </thead>
          <tbody>
            <% publicOrders.forEach(function(o){ %>
              <tr>
                <td>#<%= o.id %></td>
                <td><%= o.product_name %></td>
                <td><%= Number(o.amount || 0).toFixed(2) %> AZN</td>
                <td><%= o.status %></td>
                <td><%= new Date(o.created_at).toLocaleDateString() %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } else { %>
      <div class="text-muted">Göstəriləcək sifariş yoxdur.</div>
    <% } %>
  </div>
</div>

<style>
.public-profile-card {
  background: #fff;
  border: 1px solid #e2e8f0;
  border-radius: 16px;
  padding: 18px;
  box-shadow: 0 8px 24px rgba(15, 23, 42, 0.06);
}
.public-profile-card:first-child {
  display: flex;
  align-items: flex-start;
  gap: 16px;
}
.public-avatar {
  width: 88px;
  height: 88px;
  border-radius: 50%;
  background: #e2e8f0;
  overflow: hidden;
  display: grid;
  place-items: center;
  font-size: 28px;
  font-weight: 800;
}
.public-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.public-main h2 {
  margin: 0 0 6px;
}
.public-rank {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  font-weight: 700;
  margin-bottom: 8px;
}
.public-main p {
  margin: 0 0 8px;
  color: #475569;
}
.public-stats-grid {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 12px;
}
.public-stat-item {
  background: #fff;
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  padding: 14px;
  box-shadow: 0 6px 16px rgba(15, 23, 42, 0.04);
}
.public-stat-item small {
  display: block;
  font-size: 11px;
  color: #64748b;
  text-transform: uppercase;
  letter-spacing: .4px;
  margin-bottom: 4px;
}
.public-stat-item strong {
  font-size: 20px;
  color: #0f172a;
}
@media (max-width: 768px) {
  .public-profile-card:first-child {
    flex-direction: column;
    align-items: center;
    text-align: center;
  }
  .public-stats-grid {
    grid-template-columns: 1fr;
  }
}
</style>

<%- include('partials/footer') %>
