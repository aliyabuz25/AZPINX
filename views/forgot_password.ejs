<%- include('partials/header') %>
<div class="auth-page">
 <div class="auth-card">
 <div class="auth-header">
 <h2>Şifrəni Sıfırla</h2>
 <p>Email və ya username ilə OTP alıb yeni şifrə təyin edin</p>
 </div>

 <% if (locals.error) { %>
 <div class="alert alert-danger" style="margin-bottom: 16px;"><%= error %></div>
 <% } %>
 <% if (locals.success) { %>
 <div class="alert alert-success" style="margin-bottom: 16px;"><%= success %></div>
 <% } %>

 <div class="form-group">
 <label>Email və ya Username</label>
 <input type="text" id="resetIdentifier" class="form-control" placeholder="email və ya username">
 </div>
 <button type="button" id="sendResetOtpBtn" class="btn btn-outline" style="width:100%;">OTP göndər</button>

 <form action="/forgot-password/reset" method="POST" id="forgotResetForm" style="margin-top: 16px;">
 <div class="form-group">
 <label>OTP kodu</label>
 <input type="text" name="otp" class="form-control" required maxlength="6" placeholder="000000">
 </div>
 <div class="form-group">
 <label>Yeni şifrə</label>
 <input type="password" name="new_password" class="form-control" required minlength="6" placeholder="••••••••">
 </div>
 <div class="form-group">
 <label>Yeni şifrə (təkrar)</label>
 <input type="password" name="new_password_confirm" class="form-control" required minlength="6" placeholder="••••••••">
 </div>
 <button type="submit" class="btn btn-primary" style="width:100%;">Şifrəni yenilə</button>
 </form>

 <p style="margin-top:16px; text-align:center; font-size:13px; color:var(--text-muted);">
 <a href="/login" style="color:var(--primary-color);">Login səhifəsinə qayıt</a>
 </p>
 </div>
</div>

<script>
 document.getElementById('sendResetOtpBtn').addEventListener('click', async function () {
 const identifierInput = document.getElementById('resetIdentifier');
 const identifier = (identifierInput.value || '').trim();
 if (!identifier) {
 alert('Email və ya username daxil edin.');
 return;
 }

 this.disabled = true;
 this.innerText = 'Göndərilir...';
 try {
 const res = await fetch('/forgot-password/send-otp', {
 method: 'POST',
 headers: { 'Content-Type': 'application/json' },
 body: JSON.stringify({ identifier })
 });
 const data = await res.json();
 if (data.success) {
 alert('OTP göndərildi.');
 } else {
 alert(data.error || 'Xəta baş verdi.');
 }
 } catch (e) {
 alert('Bağlantı xətası.');
 } finally {
 this.disabled = false;
 this.innerText = 'OTP göndər';
 }
 });
</script>

<%- include('partials/footer') %>
