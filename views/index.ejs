<%- include('partials/header') %>

    <main>
        <!-- Hero Section -->
        <section class="hero">

            <div class="slider-container">
                <% sliders.forEach(function(slider, index) { %>
                    <div class="slider-item <%= index === 0 ? 'active' : '' %>"
                        style="background-image: url('<%= slider.image %>');">
                        <% if (slider.title || slider.description) { %>
                            <div class="slider-content">
                                <% if (slider.title) { %>
                                    <h2>
                                        <%= slider.title %>
                                    </h2>
                                    <% } %>
                                        <% if (slider.description) { %>
                                            <p>
                                                <%= slider.description %>
                                            </p>
                                            <% } %>
                                                <a href="<%= slider.link %>" class="btn btn-primary"
                                                    style="width: fit-content;">İndi al</a>
                            </div>
                            <% } %>
                    </div>
                    <% }) %>
            </div>
        </section>

        <!-- Quick Icons Row -->
        <section class="quick-icons-row">
            <% quickActions.forEach(function(action) { %>
                <a href="/?category=<%= encodeURIComponent(action.name) %>" class="quick-icon-card">
                    <div class="img-box d-flex align-items-center justify-content-center">
                        <% if (action.image_path) { %>
                            <img src="<%= action.image_path %>" alt="<%= action.name %>"
                                onerror="this.src='https://via.placeholder.com/70?text=GAME'">
                            <% } else { %>
                                <i class="fa-solid <%= action.icon %> fa-2x" style="color: var(--primary-color);"></i>
                                <% } %>
                    </div>
                    <span>
                        <%= action.name %>
                    </span>
                </a>
                <% }) %>
        </section>

        <!-- Dynamic Sections or Featured Products -->
        <% if (searchQuery || selectedCategory) { %>
            <!-- Search/Category Result View (Standard Grid) -->
            <section class="section-container">
                <div class="section-header">
                    <h3>
                        <%= selectedCategory ? selectedCategory : (searchQuery ? 'Axtarış Nəticələri' : 'Məhsullar' ) %>
                    </h3>
                    <a href="/" class="view-all"><i class="fa-solid fa-xmark"></i> Filtrləri təmizlə</a>
                </div>

                <% if (featuredProducts.length===0) { %>
                    <div class="text-center py-5">
                        <i class="fa-solid fa-box-open fa-3x text-muted mb-3"></i>
                        <p class="text-muted">Məhsul tapılmadı.</p>
                    </div>
                    <% } else { %>
                        <div class="product-grid">
                            <% featuredProducts.forEach(function(product) { %>
                                <%- include('partials/product_card', { product: product }) %>
                                    <% }) %>
                        </div>

                        <!-- Pagination Controls -->
                        <% if (totalPages> 1) { %>
                            <div class="pagination-container">
                                <ul class="pagination">
                                    <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                                        <a class="page-link"
                                            href="/?page=<%= currentPage - 1 %><%= selectedCategory ? '&category=' + encodeURIComponent(selectedCategory) : '' %><%= searchQuery ? '&search=' + encodeURIComponent(searchQuery) : '' %>">
                                            <i class="fa-solid fa-chevron-left"></i>
                                        </a>
                                    </li>
                                    <% for(let i=1; i <=totalPages; i++) { %>
                                        <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                                            <a class="page-link"
                                                href="/?page=<%= i %><%= selectedCategory ? '&category=' + encodeURIComponent(selectedCategory) : '' %><%= searchQuery ? '&search=' + encodeURIComponent(searchQuery) : '' %>">
                                                <%= i %>
                                            </a>
                                        </li>
                                        <% } %>
                                            <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
                                                <a class="page-link"
                                                    href="/?page=<%= currentPage + 1 %><%= selectedCategory ? '&category=' + encodeURIComponent(selectedCategory) : '' %><%= searchQuery ? '&search=' + encodeURIComponent(searchQuery) : '' %>">
                                                    <i class="fa-solid fa-chevron-right"></i>
                                                </a>
                                            </li>
                                </ul>
                            </div>
                            <% } %>
                                <% } %>
            </section>

            <% } else if (locals.homeSections && homeSections.length> 0) { %>
                <!-- Dynamic Home Sections -->
                <% homeSections.forEach(section=> { %>
                    <% if (section.products && section.products.length> 0) { %>
                        <section class="section-container">
                            <div class="section-header">
                                <h3>
                                    <%= section.title %>
                                </h3>
                                <% if (section.category_id && section.category_name) { %>
                                    <a href="/?category=<%= encodeURIComponent(section.category_name) %>"
                                        class="view-all">Hamısına bax <i class="fa-solid fa-arrow-right"></i></a>
                                    <% } %>
                            </div>
                            <div class="product-grid">
                                <% section.products.forEach(function(product) { %>
                                    <%- include('partials/product_card', { product: product }) %>
                                        <% }) %>
                            </div>
                        </section>
                        <% } %>
                            <% }) %>

                                <% } else { %>
                                    <!-- Fallback: Default Featured Products -->
                                    <section class="section-container">
                                        <div class="section-header">
                                            <h3>Önə Çıxanlar</h3>
                                            <a href="/" class="view-all">Hamısına bax <i
                                                    class="fa-solid fa-arrow-right"></i></a>
                                        </div>
                                        <div class="product-grid">
                                            <% featuredProducts.forEach(function(product) { %>
                                                <%- include('partials/product_card', { product: product }) %>
                                                    <% }) %>
                                        </div>
                                        <!-- Pagination Controls -->
                                        <% if (totalPages> 1) { %>
                                            <div class="pagination-container">
                                                <ul class="pagination">
                                                    <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                                                        <a class="page-link" href="/?page=<%= currentPage - 1 %>">
                                                            <i class="fa-solid fa-chevron-left"></i>
                                                        </a>
                                                    </li>
                                                    <% for(let i=1; i <=totalPages; i++) { %>
                                                        <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                                                            <a class="page-link" href="/?page=<%= i %>">
                                                                <%= i %>
                                                            </a>
                                                        </li>
                                                        <% } %>
                                                            <li
                                                                class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
                                                                <a class="page-link"
                                                                    href="/?page=<%= currentPage + 1 %>">
                                                                    <i class="fa-solid fa-chevron-right"></i>
                                                                </a>
                                                            </li>
                                                </ul>
                                            </div>
                                            <% } %>
                                    </section>
                                    <% } %>

                                        <!-- Promo Banner -->
                                        <section class="section-container" style="margin-top: 40px;">
                                            <div
                                                style="background: var(--accent-color); padding: 40px; border-radius: var(--radius-lg); color: white; display: flex; justify-content: space-between; align-items: center; background-image: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);">
                                                <div>
                                                    <h2 style="font-size: 32px; margin-bottom: 10px; font-weight: 800;">
                                                        Endirimləri qaçırma!</h2>
                                                    <p style="opacity: 0.9; font-size: 16px;">Bütün oyunlar üçün ən ucuz
                                                        rəqəmsal kodlar yalnız bizdə.
                                                    </p>
                                                </div>
                                                <a href="/register" class="btn btn-primary"
                                                    style="padding: 15px 40px; border-radius: 12px; font-size: 16px; background: white; color: var(--primary-color);">Qeydiyyatdan
                                                    keç</a>
                                            </div>
                                        </section>

                                        <!-- Popular Games Section -->
                                        <section class="section-container">
                                            <div class="section-header">
                                                <h3>Populyar Oyunlar</h3>
                                                <a href="/" class="view-all">Hamısına bax <i
                                                        class="fa-solid fa-arrow-right"></i></a>
                                            </div>
                                            <div class="product-grid">
                                                <% featuredProducts.slice(0, 4).forEach(function(product) { %>
                                                    <%- include('partials/product_card', { product: product }) %>
                                                        <% }) %>
                                            </div>
                                        </section>

                                        <!-- Stats -->
                                        <section class="stats-section">
                                            <div class="stats-grid">
                                                <div class="stat-item">
                                                    <div class="stat-icon"><i class="fa-solid fa-users"></i></div>
                                                    <h4>
                                                        <%= typeof stats !=='undefined' ? stats.users : '50K' %>+
                                                    </h4>
                                                    <p>Müştəri</p>
                                                </div>
                                                <div class="stat-item">
                                                    <div class="stat-icon"><i class="fa-solid fa-gamepad"></i></div>
                                                    <h4>
                                                        <%= typeof stats !=='undefined' ? stats.products : '1000' %>+
                                                    </h4>
                                                    <p>Məhsul</p>
                                                </div>
                                                <div class="stat-item">
                                                    <div class="stat-icon"><i class="fa-solid fa-bolt"></i></div>
                                                    <h4>
                                                        <%= typeof stats !=='undefined' ? stats.deliveryTime
                                                            : '3 Saniyə' %>
                                                    </h4>
                                                    <p>Sürətli Çatdırılma</p>
                                                </div>
                                                <div class="stat-item">
                                                    <div class="stat-icon"><i class="fa-solid fa-star"></i></div>
                                                    <h4>
                                                        <%= typeof stats !=='undefined' ? stats.rating : '4.9/5' %>
                                                    </h4>
                                                    <p>Reytinq</p>
                                                </div>
                                            </div>
                                        </section>
    </main>



    <!-- Cart Sidebar -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h3>Səbətin</h3>
            <div class="modal-close" id="closeCart"><i class="fa-solid fa-xmark"></i></div>
        </div>
        <div class="cart-items" id="cartItemsList">
            <!-- Cart items injected here -->
        </div>
        <div class="cart-footer">
            <div class="total-row">
                <span>Cəmi:</span>
                <span id="cartTotal">0.00 AZN</span>
            </div>
            <a href="/checkout" class="btn btn-primary"
                style="width: 100%; padding: 15px; text-decoration: none; display: block; text-align: center;">Sifarişi
                tamamla</a>
        </div>
    </div>

    <%- include('partials/footer') %>