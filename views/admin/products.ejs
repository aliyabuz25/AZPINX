<%- include('header') %>

 <div class="row">
 <div class="col-12">
 <div class="card admin-toolbar-card mb-3">
 <div class="card-body py-3">
 <form action="/admin/products" method="GET" class="admin-toolbar-form">
 <div class="admin-toolbar-main">
 <input
 type="text"
 name="q"
 class="form-control"
 placeholder="Məhsul adı, kateqoriya, API ID ilə axtar..."
 value="<%= filters && filters.q ? filters.q : '' %>">
 </div>
 <div class="admin-toolbar-filters">
 <select name="status" class="form-control">
 <option value="all" <%= !filters || filters.status === 'all' ? 'selected' : '' %>>Bütün statuslar</option>
 <option value="sale" <%= filters && filters.status === 'sale' ? 'selected' : '' %>>Satışda</option>
 <option value="draft" <%= filters && filters.status === 'draft' ? 'selected' : '' %>>Taslak</option>
 </select>
 <select name="active" class="form-control">
 <option value="all" <%= !filters || filters.active === 'all' ? 'selected' : '' %>>Bütün aktivlik</option>
 <option value="active" <%= filters && filters.active === 'active' ? 'selected' : '' %>>Aktiv</option>
 <option value="inactive" <%= filters && filters.active === 'inactive' ? 'selected' : '' %>>Deaktiv</option>
 </select>
 <select name="source" class="form-control">
 <option value="all" <%= !filters || filters.source === 'all' ? 'selected' : '' %>>Bütün mənbələr</option>
 <option value="api" <%= filters && filters.source === 'api' ? 'selected' : '' %>>API</option>
 <option value="api_local" <%= filters && filters.source === 'api_local' ? 'selected' : '' %>>API + Lokal</option>
 <option value="local" <%= filters && filters.source === 'local' ? 'selected' : '' %>>Lokal</option>
 </select>
 <button type="submit" class="btn btn-primary">Axtar</button>
 <a href="/admin/products" class="btn btn-outline-secondary">Sıfırla</a>
 </div>
 </form>
 <small class="text-muted d-block mt-2">
 Toplam: <%= pagination ? pagination.totalItems : products.length %> məhsul
 </small>
 </div>
 </div>

 <div class="card">
 <div class="card-header border-transparent">
 <h3 class="card-title">Məhsul Kataloqu</h3>
 <div class="card-tools">
 <a href="/admin/products/export" class="btn btn-sm btn-success mr-2">
 <i class="ri-download-2-line"></i> Export JSON
 </a>
 <form action="/admin/products/import" method="POST" enctype="multipart/form-data" class="d-inline-flex align-items-center mr-2">
 <input type="file" name="backup_file" accept="application/json,.json" required class="form-control form-control-sm mr-1" style="width: 210px;">
 <button type="submit" class="btn btn-sm btn-warning">
 <i class="ri-upload-2-line"></i> Import JSON
 </button>
 </form>
 <a href="/admin/products/add" class="btn btn-sm btn-info mr-2">
 <i class="ri-add-line"></i> Yeni Məhsul
 </a>
 <a href="/admin/categories" class="btn btn-sm btn-secondary mr-2">
 <i class="ri-stack-line"></i> Kateqoriyalar
 </a>
 <button type="button" class="btn btn-tool" data-card-widget="collapse">
 <i class="ri-subtract-line"></i>
 </button>
 </div>
 </div>
 <div class="card-body p-0">
 <div class="table-responsive">
 <table class="table m-0 table-hover">
 <thead>
 <tr>
 <th>Şəkil</th>
 <th>Məhsul Adı</th>
 <th>Kateqoriya</th>
 <th>Status</th>
 <th>Aktivlik</th>
 <th>Qiymət</th>
 <th>Mənbə</th>
 <th>Əməliyyat</th>
 </tr>
 </thead>
 <tbody>
 <% if (products && products.length > 0) { %>
 <% products.forEach(product=> { %>
 <tr>
 <td>
 <img src="<%= product.image %>" class="img-size-32 mr-2" alt="Product Image"
 style="object-fit: contain;">
 </td>
 <td>
 <%= product.name %>
 </td>
 <td>
 <%= product.category %>
 </td>
 <td>
 <% if (product.status==='sale' ) { %>
 <span class="badge badge-success">SATIŞDA</span>
 <% } else { %>
 <span class="badge badge-warning">TASLAK</span>
 <% } %>
 </td>
 <td>
 <% if (product.is_active) { %>
 <span class="badge badge-primary">AKTIV</span>
 <% } else { %>
 <span class="badge badge-secondary">DEAKTIV</span>
 <% } %>
 </td>
 <td>
 <%= product.price %> AZN
 </td>
 <td>
 <% if (product.api_id && !product.is_local) { %>
 <span class="badge badge-info">API</span>
 <% } else if (product.api_id && product.is_local) { %>
 <span class="badge badge-warning">API + Lokal</span>
 <% } else { %>
 <span class="badge badge-success">Lokal</span>
 <% } %>
 </td>
 <td>
 <form action="/admin/products/<%= product.id %>/toggle-active" method="POST" style="display:inline-block;">
 <button type="submit" class="btn btn-sm <%= product.is_active ? 'btn-warning' : 'btn-success' %> mr-1">
 <i class="<%= product.is_active ? 'ri-pause-circle-line' : 'ri-play-circle-line' %>"></i>
 <%= product.is_active ? 'Deaktiv et' : 'Aktiv et' %>
 </button>
 </form>
 <a href="/admin/products/<%= product.id %>/edit"
 class="btn btn-sm btn-primary">
 <i class="ri-edit-2-line"></i> Redaktə
 </a>
 </td>
 </tr>
 <% }) %>
 <% } else { %>
 <tr>
 <td colspan="8" class="text-center py-4 text-muted">Axtarış və filtrlərə uyğun məhsul tapılmadı.</td>
 </tr>
 <% } %>
 </tbody>
 </table>
 </div>
 </div>
 <% if (pagination && pagination.totalPages > 1) { %>
 <div class="card-footer border-top">
 <ul class="pagination pagination-sm m-0 justify-content-end">
 <li class="page-item <%= pagination.currentPage <= 1 ? 'disabled' : '' %>">
 <a class="page-link" href="/admin/products?page=<%= pagination.currentPage - 1 %><%= pagination.baseQuery ? '&' + pagination.baseQuery : '' %>">&laquo;</a>
 </li>
 <% for (let i = 1; i <= pagination.totalPages; i++) { %>
 <li class="page-item <%= i === pagination.currentPage ? 'active' : '' %>">
 <a class="page-link" href="/admin/products?page=<%= i %><%= pagination.baseQuery ? '&' + pagination.baseQuery : '' %>"><%= i %></a>
 </li>
 <% } %>
 <li class="page-item <%= pagination.currentPage >= pagination.totalPages ? 'disabled' : '' %>">
 <a class="page-link" href="/admin/products?page=<%= pagination.currentPage + 1 %><%= pagination.baseQuery ? '&' + pagination.baseQuery : '' %>">&raquo;</a>
 </li>
 </ul>
 </div>
 <% } %>
 <div class="card-footer clearfix">
 <p class="text-sm text-muted mb-0">* API-dən gələn məhsullar üzərində dəyişiklik etdikdə onlar lokal
 olaraq MySQL-də yadda saxlanılır.</p>
 </div>
 </div>
 </div>
 </div>

 <%- include('footer') %>
