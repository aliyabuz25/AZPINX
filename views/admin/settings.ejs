<%- include('header') %>
<%
 const trBanks = [
 'Adabank', 'Akbank', 'Aktif Yatirim Bankasi (Aktif Bank)', 'Albaraka Turk',
 'Alternatifbank', 'Anadolubank', 'BankPozitif', 'Burgan Bank',
 'DenizBank', 'Diler Yatirim Bankasi', 'Fibabanka', 'Garanti BBVA',
 'Hayat Finans Katilim Bankasi', 'ICBC Turkey Bank', 'ING Bank',
 'Intesa Sanpaolo', 'Nurol Yatirim Bankasi', 'Odea Bank', 'QNB Bank',
 'Rabobank', 'Sehir Yatirim Bankasi', 'Standard Chartered Yatirim Bankasi',
 'Turkish Bank', 'Turkland Bank (T-Bank)', 'Turkiye Finans Katilim Bankasi',
 'Turkiye Garanti Bankasi', 'Turkiye Halk Bankasi', 'Turkiye Is Bankasi',
 'Turkiye Kalkinma ve Yatirim Bankasi', 'Turkiye Sinai Kalkinma Bankasi',
 'Turkiye Vakiflar Bankasi', 'Yapi ve Kredi Bankasi (Yapi Kredi)',
 'Ziraat Bankasi', 'Ziraat Katilim', 'Vakif Katilim', 'Emlak Katilim',
 'Iller Bankasi', 'Dunya Katilim Bankasi'
 ];
 const selectedTrBank = String(settings.tr_bank_name || '');
%>

 <div class="row">
 <div class="col-md-6">
 <div class="card card-primary">
 <div class="card-header">
 <h3 class="card-title">Banka Məlumatlarının İdarə Edilməsi</h3>
 </div>
 <form action="/admin/settings" method="POST">
 <div class="card-body">
 <div class="form-group">
 <label for="bank_card">Kart Nömrəsi</label>
 <input type="text" name="bank_card" id="bank_card" class="form-control"
 value="<%= settings.bank_card || '' %>" required>
 </div>
 <div class="form-group">
 <label for="bank_holder">Kart Sahibi (Ad Soyad)</label>
 <input type="text" name="bank_holder" id="bank_holder" class="form-control"
 value="<%= settings.bank_holder || '' %>" required>
 </div>
 <div class="form-group">
 <label for="bank_name">Bank Adı</label>
 <input type="text" name="bank_name" id="bank_name" class="form-control"
 value="<%= settings.bank_name || '' %>" required>
 </div>
 <hr>
 <h5>Turkiye - IBAN Bilgileri</h5>
 <div class="form-group">
 <label for="tr_bank_name">Banka Adi (Dropdown)</label>
 <select name="tr_bank_name" id="tr_bank_name" class="form-control">
 <option value="">Banka secin</option>
 <% trBanks.forEach(function(bank){ %>
 <option value="<%= bank %>" <%= selectedTrBank === bank ? 'selected' : '' %>><%= bank %></option>
 <% }) %>
 <% if (selectedTrBank && !trBanks.includes(selectedTrBank)) { %>
 <option value="<%= selectedTrBank %>" selected><%= selectedTrBank %></option>
 <% } %>
 </select>
 </div>
 <div class="form-group">
 <label for="tr_iban">IBAN</label>
 <input type="text" name="tr_iban" id="tr_iban" class="form-control"
 value="<%= settings.tr_iban || '' %>" placeholder="TR00 0000 0000 0000 0000 0000 00">
 </div>
 <div class="form-group">
 <label for="tr_account_holder">Isim Soyisim</label>
 <input type="text" name="tr_account_holder" id="tr_account_holder" class="form-control"
 value="<%= settings.tr_account_holder || '' %>">
 </div>
 <div class="form-group">
 <label for="reseller_discount_percent">Bayi Endirimi (%)</label>
 <input type="number" min="0" max="90" step="0.1" name="reseller_discount_percent" id="reseller_discount_percent" class="form-control"
 value="<%= settings.reseller_discount_percent || '8' %>" required>
 <small class="form-text text-muted">Bayi məhsul qiymətlərinə avtomatik tətbiq olunur.</small>
 </div>

 <div class="mt-4">
 <h5>Önizləmə (Preview)</h5>
 <div class="bank-card-preview-admin">
 <p class="card-label-admin">KART NÖMRƏSİ</p>
 <p class="card-num-admin" id="preview_card">
 <%= settings.bank_card || '0000 0000 0000 0000' %>
 </p>
 <div class="card-footer-info-admin">
 <span id="preview_holder">
 <%= settings.bank_holder || 'ADMIN' %>
 </span>
 <span id="preview_bank">
 <%= settings.bank_name || 'BANK' %>
 </span>
 </div>
 </div>
 </div>
 <div class="mt-3">
 <h5>IBAN Onizleme</h5>
 <div class="bank-card-preview-admin">
 <p class="card-label-admin">IBAN</p>
 <p class="card-num-admin iban-num-admin" id="preview_iban"><%= settings.tr_iban || 'TR00 0000 0000 0000 0000 0000 00' %></p>
 <div class="card-footer-info-admin">
 <span id="preview_tr_holder"><%= settings.tr_account_holder || 'ISIM SOYISIM' %></span>
 <span id="preview_tr_bank"><%= settings.tr_bank_name || 'BANKA' %></span>
 </div>
 </div>
 </div>
 </div>
 <div class="card-footer">
 <button type="submit" class="btn btn-primary">Yadda Saxla</button>
 </div>
 </form>
 </div>
 </div>

 <div class="col-md-6">
 <div class="card card-primary">
 <div class="card-header">
 <h3 class="card-title">SEO Ayarları</h3>
 </div>
 <form action="/admin/settings" method="POST">
 <div class="card-body">
 <input type="hidden" name="bank_card" value="<%= settings.bank_card || '' %>">
 <input type="hidden" name="bank_holder" value="<%= settings.bank_holder || '' %>">
 <input type="hidden" name="bank_name" value="<%= settings.bank_name || '' %>">
 <input type="hidden" name="tr_iban" value="<%= settings.tr_iban || '' %>">
 <input type="hidden" name="tr_bank_name" value="<%= settings.tr_bank_name || '' %>">
 <input type="hidden" name="tr_account_holder" value="<%= settings.tr_account_holder || '' %>">
 <input type="hidden" name="reseller_discount_percent" value="<%= settings.reseller_discount_percent || '8' %>">

 <div class="form-group">
 <label for="seo_meta_title">Meta Title</label>
 <input type="text" name="seo_meta_title" id="seo_meta_title" class="form-control" value="<%= settings.seo_meta_title || '' %>" maxlength="70">
 </div>
 <div class="form-group">
 <label for="seo_meta_description">Meta Description</label>
 <textarea name="seo_meta_description" id="seo_meta_description" class="form-control" rows="4" maxlength="170"><%= settings.seo_meta_description || '' %></textarea>
 </div>
 <div class="form-group">
 <label for="seo_meta_keywords">Meta Keywords</label>
 <input type="text" name="seo_meta_keywords" id="seo_meta_keywords" class="form-control" value="<%= settings.seo_meta_keywords || '' %>" placeholder="azpinx, pubg uc, valorant vp">
 </div>
 <div class="form-group">
 <label for="seo_robots">Robots</label>
 <select name="seo_robots" id="seo_robots" class="form-control">
 <option value="index,follow" <%= (settings.seo_robots || 'index,follow') === 'index,follow' ? 'selected' : '' %>>index,follow</option>
 <option value="noindex,nofollow" <%= (settings.seo_robots || '') === 'noindex,nofollow' ? 'selected' : '' %>>noindex,nofollow</option>
 </select>
 </div>
 </div>
 <div class="card-footer">
 <button type="submit" class="btn btn-primary">SEO Yadda Saxla</button>
 </div>
 </form>
 </div>
 </div>
 </div>

 <div class="row mt-3">
 <div class="col-12">
 <div class="card card-primary">
 <div class="card-header">
 <h3 class="card-title">Footer Məzmunu (Tam İdarəetmə)</h3>
 </div>
 <form action="/admin/settings" method="POST">
 <div class="card-body">
 <div class="form-group">
 <label for="footer_about_text">Haqqımızda mətni</label>
 <textarea name="footer_about_text" id="footer_about_text" class="form-control" rows="3"><%= settings.footer_about_text || '' %></textarea>
 </div>

 <div class="form-row">
 <div class="form-group col-md-6">
 <label for="footer_trust_1">Güvən nişanı 1</label>
 <input type="text" name="footer_trust_1" id="footer_trust_1" class="form-control" value="<%= settings.footer_trust_1 || '' %>">
 </div>
 <div class="form-group col-md-6">
 <label for="footer_trust_2">Güvən nişanı 2</label>
 <input type="text" name="footer_trust_2" id="footer_trust_2" class="form-control" value="<%= settings.footer_trust_2 || '' %>">
 </div>
 </div>

 <hr>
 <h6>Sürətli Keçidlər</h6>
 <div class="form-row">
 <div class="form-group col-md-4">
 <label for="footer_quick_title">Bölmə başlığı</label>
 <input type="text" name="footer_quick_title" id="footer_quick_title" class="form-control" value="<%= settings.footer_quick_title || '' %>">
 </div>
 <div class="form-group col-md-4">
 <label for="footer_quick_1_label">Link 1 Mətn</label>
 <input type="text" name="footer_quick_1_label" id="footer_quick_1_label" class="form-control" value="<%= settings.footer_quick_1_label || '' %>">
 </div>
 <div class="form-group col-md-4">
 <label for="footer_quick_1_url">Link 1 URL</label>
 <input type="text" name="footer_quick_1_url" id="footer_quick_1_url" class="form-control" value="<%= settings.footer_quick_1_url || '' %>">
 </div>
 </div>
 <div class="form-row">
 <div class="form-group col-md-6">
 <label for="footer_quick_2_label">Link 2 Mətn</label>
 <input type="text" name="footer_quick_2_label" id="footer_quick_2_label" class="form-control" value="<%= settings.footer_quick_2_label || '' %>">
 </div>
 <div class="form-group col-md-6">
 <label for="footer_quick_2_url">Link 2 URL</label>
 <input type="text" name="footer_quick_2_url" id="footer_quick_2_url" class="form-control" value="<%= settings.footer_quick_2_url || '' %>">
 </div>
 </div>
 <div class="form-row">
 <div class="form-group col-md-6">
 <label for="footer_quick_3_label">Link 3 Mətn</label>
 <input type="text" name="footer_quick_3_label" id="footer_quick_3_label" class="form-control" value="<%= settings.footer_quick_3_label || '' %>">
 </div>
 <div class="form-group col-md-6">
 <label for="footer_quick_3_url">Link 3 URL</label>
 <input type="text" name="footer_quick_3_url" id="footer_quick_3_url" class="form-control" value="<%= settings.footer_quick_3_url || '' %>">
 </div>
 </div>

 <hr>
 <h6>Hesabım Bölməsi</h6>
 <div class="form-row">
 <div class="form-group col-md-4">
 <label for="footer_account_title">Bölmə başlığı</label>
 <input type="text" name="footer_account_title" id="footer_account_title" class="form-control" value="<%= settings.footer_account_title || '' %>">
 </div>
 <div class="form-group col-md-4">
 <label for="footer_account_1_label">Link 1 Mətn</label>
 <input type="text" name="footer_account_1_label" id="footer_account_1_label" class="form-control" value="<%= settings.footer_account_1_label || '' %>">
 </div>
 <div class="form-group col-md-4">
 <label for="footer_account_1_url">Link 1 URL</label>
 <input type="text" name="footer_account_1_url" id="footer_account_1_url" class="form-control" value="<%= settings.footer_account_1_url || '' %>">
 </div>
 </div>
 <div class="form-row">
 <div class="form-group col-md-6">
 <label for="footer_account_2_label">Link 2 Mətn</label>
 <input type="text" name="footer_account_2_label" id="footer_account_2_label" class="form-control" value="<%= settings.footer_account_2_label || '' %>">
 </div>
 <div class="form-group col-md-6">
 <label for="footer_account_2_url">Link 2 URL</label>
 <input type="text" name="footer_account_2_url" id="footer_account_2_url" class="form-control" value="<%= settings.footer_account_2_url || '' %>">
 </div>
 </div>
 <div class="form-row">
 <div class="form-group col-md-6">
 <label for="footer_account_3_label">Link 3 Mətn</label>
 <input type="text" name="footer_account_3_label" id="footer_account_3_label" class="form-control" value="<%= settings.footer_account_3_label || '' %>">
 </div>
 <div class="form-group col-md-6">
 <label for="footer_account_3_url">Link 3 URL</label>
 <input type="text" name="footer_account_3_url" id="footer_account_3_url" class="form-control" value="<%= settings.footer_account_3_url || '' %>">
 </div>
 </div>

 <hr>
 <h6>Əlaqə və Alt Sətir</h6>
 <div class="form-row">
 <div class="form-group col-md-4">
 <label for="footer_contact_title">Əlaqə başlığı</label>
 <input type="text" name="footer_contact_title" id="footer_contact_title" class="form-control" value="<%= settings.footer_contact_title || '' %>">
 </div>
 <div class="form-group col-md-4">
 <label for="footer_whatsapp_label">WhatsApp label</label>
 <input type="text" name="footer_whatsapp_label" id="footer_whatsapp_label" class="form-control" value="<%= settings.footer_whatsapp_label || '' %>">
 </div>
 <div class="form-group col-md-4">
 <label for="footer_whatsapp_value">WhatsApp dəyəri</label>
 <input type="text" name="footer_whatsapp_value" id="footer_whatsapp_value" class="form-control" value="<%= settings.footer_whatsapp_value || '' %>">
 </div>
 </div>
 <div class="form-row">
 <div class="form-group col-md-6">
 <label for="footer_email_label">E-poçt label</label>
 <input type="text" name="footer_email_label" id="footer_email_label" class="form-control" value="<%= settings.footer_email_label || '' %>">
 </div>
 <div class="form-group col-md-6">
 <label for="footer_email_value">E-poçt dəyəri</label>
 <input type="text" name="footer_email_value" id="footer_email_value" class="form-control" value="<%= settings.footer_email_value || '' %>">
 </div>
 </div>
 <div class="form-group">
 <label for="footer_bottom_text">Alt footer mətni</label>
 <input type="text" name="footer_bottom_text" id="footer_bottom_text" class="form-control" value="<%= settings.footer_bottom_text || '' %>">
 </div>
 <div class="form-group">
 <label for="footer_payment_text">Ödəniş ikonları yanında mətn</label>
 <input type="text" name="footer_payment_text" id="footer_payment_text" class="form-control" value="<%= settings.footer_payment_text || '' %>">
 </div>
 </div>
 <div class="card-footer">
 <button type="submit" class="btn btn-primary">Footer Yadda Saxla</button>
 </div>
 </form>
 </div>
 </div>
 </div>

 <%
 const selectedWhatsappAdminIds = String(settings.admin_whatsapp_admin_ids || '')
 .split(',')
 .map(function(v){ return String(v || '').trim(); })
 .filter(Boolean);
 const selectedWhatsappEvents = String(settings.admin_whatsapp_events || 'order,ticket,refund,topup')
 .split(',')
 .map(function(v){ return String(v || '').trim().toLowerCase(); })
 .filter(Boolean);
 %>

 <div class="row mt-3">
 <div class="col-12">
 <div class="card card-primary">
 <div class="card-header">
 <h3 class="card-title">Admin WhatsApp Bildirişləri</h3>
 </div>
 <form action="/admin/settings" method="POST">
 <div class="card-body">
 <div class="form-group">
 <div class="custom-control custom-switch">
 <input type="checkbox" class="custom-control-input" id="admin_whatsapp_enabled" name="admin_whatsapp_enabled" <%= String(settings.admin_whatsapp_enabled || '1') === '1' ? 'checked' : '' %>>
 <label class="custom-control-label" for="admin_whatsapp_enabled">WhatsApp admin bildirişlərini aktiv et</label>
 </div>
 </div>

 <div class="form-group">
 <label for="admin_whatsapp_admin_ids">Bildiriş alacaq adminlər (çoxlu seçim)</label>
 <select name="admin_whatsapp_admin_ids" id="admin_whatsapp_admin_ids" class="form-control" multiple size="6">
 <% (admins || []).forEach(function(admin){ %>
 <option value="<%= admin.id %>" <%= selectedWhatsappAdminIds.includes(String(admin.id)) ? 'selected' : '' %>>
 <%= admin.full_name %> <% if (admin.phone) { %> - <%= admin.phone %> <% } %>
 </option>
 <% }) %>
 </select>
 <small class="text-muted">Boş qalsa bütün adminlərə göndərilir.</small>
 </div>

 <div class="form-group">
 <label>Bildiriş növləri</label>
 <div class="form-check">
 <input class="form-check-input" type="checkbox" id="wa_event_order" name="admin_whatsapp_events" value="order" <%= selectedWhatsappEvents.includes('order') ? 'checked' : '' %>>
 <label class="form-check-label" for="wa_event_order">Sifariş məlumatı</label>
 </div>
 <div class="form-check">
 <input class="form-check-input" type="checkbox" id="wa_event_ticket" name="admin_whatsapp_events" value="ticket" <%= selectedWhatsappEvents.includes('ticket') ? 'checked' : '' %>>
 <label class="form-check-label" for="wa_event_ticket">Dəstək talebi / ticket mesajı</label>
 </div>
 <div class="form-check">
 <input class="form-check-input" type="checkbox" id="wa_event_refund" name="admin_whatsapp_events" value="refund" <%= selectedWhatsappEvents.includes('refund') ? 'checked' : '' %>>
 <label class="form-check-label" for="wa_event_refund">İade tələbləri</label>
 </div>
 <div class="form-check">
 <input class="form-check-input" type="checkbox" id="wa_event_topup" name="admin_whatsapp_events" value="topup" <%= selectedWhatsappEvents.includes('topup') ? 'checked' : '' %>>
 <label class="form-check-label" for="wa_event_topup">Balans artırma tələbləri</label>
 </div>
 </div>
 </div>
 <div class="card-footer">
 <button type="submit" class="btn btn-primary">WhatsApp Ayarlarını Yadda Saxla</button>
 </div>
 </form>
 </div>
 </div>
 </div>

 <style>
 .bank-card-preview-admin {
 background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
 color: white;
 padding: 25px;
 border-radius: 16px;
 margin: 10px 0;
 box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
 max-width: 400px;
 }

 .card-label-admin {
 font-size: 11px;
 opacity: 0.6;
 letter-spacing: 1px;
 margin-bottom: 5px;
 }

 .card-num-admin {
 font-size: 20px;
 letter-spacing: 2px;
 font-weight: 700;
 font-family: monospace;
 }

 .card-footer-info-admin {
 display: flex;
 justify-content: space-between;
 margin-top: 20px;
 font-size: 14px;
 font-weight: 500;
 }

 .iban-num-admin {
 letter-spacing: 1px;
 font-size: 17px;
 }
 </style>

 <script>
 document.getElementById('bank_card').addEventListener('input', function (e) {
 document.getElementById('preview_card').textContent = e.target.value || '0000 0000 0000 0000';
 });
 document.getElementById('bank_holder').addEventListener('input', function (e) {
 document.getElementById('preview_holder').textContent = e.target.value || 'ADMIN';
 });
 document.getElementById('bank_name').addEventListener('input', function (e) {
 document.getElementById('preview_bank').textContent = e.target.value || 'BANK';
 });
 document.getElementById('tr_iban').addEventListener('input', function (e) {
 document.getElementById('preview_iban').textContent = e.target.value || 'TR00 0000 0000 0000 0000 0000 00';
 });
 document.getElementById('tr_account_holder').addEventListener('input', function (e) {
 document.getElementById('preview_tr_holder').textContent = e.target.value || 'ISIM SOYISIM';
 });
 document.getElementById('tr_bank_name').addEventListener('change', function (e) {
 document.getElementById('preview_tr_bank').textContent = e.target.value || 'BANKA';
 });
 </script>

 <%- include('footer') %>
